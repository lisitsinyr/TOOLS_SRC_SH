1.Подготовка сервера

1.1. Время

Для корректного отображения дат, необходимо
позаботиться о синхронизации времени. Для этого
будем использовать демон chrony. Установим его:

[lyrnet_samba_crony.sh]
# --------------------------------------------
# синхронизации времени
# --------------------------------------------
# Установка демона chrony
# --------------------------------------------
#sudo apt-get update && sudo apt-get install chrony
sudo apt update && sudo apt install chrony
# --------------------------------------------
# Разрешение автозапуска сервиса chrony
# --------------------------------------------
sudo systemctl enable chrony

1.2. Настройка брандмауэра (firewall)

[lyrnet_samba_firewall.sh]

# --------------------------------------------
# Настройка брандмауэра (firewall)
# --------------------------------------------
# По умолчанию, в системах на базе Debian брандмауэр
# разрешает все соединения. Но если в нашем случае
# мы используем брандмауэр, необходимо открыть порты:
# 445 используется для samba
# 137, 138 и 139 - для работы NetBIOS (использование имени компьютера для доступа)
# --------------------------------------------
sudo iptables -I INPUT -p tcp --dport 445 -j ACCEPT
sudo iptables -I INPUT -p udp --dport 137:138 -j ACCEPT
sudo iptables -I INPUT -p tcp --dport 139 -j ACCEPT

# --------------------------------------------
# Применяем настройки
# --------------------------------------------
#sudo apt-get update && sudo apt-get install iptables-persistent
sudo apt update && sudo apt install iptables-persistent

sudo netfilter-persistent save

2.Установка и запуск Samba

[lyrnet_samba_install.sh]

# --------------------------------------------
#  Установка выполняется из репозитория samba
# --------------------------------------------
#sudo apt-get update && sudo apt-get install samba
sudo apt update && sudo apt install samba

# --------------------------------------------
#  Разрешаем автостарт сервиса smbd
# --------------------------------------------
sudo systemctl enable smbd

# --------------------------------------------
#  Проверка, что сервис smbd запустился
# --------------------------------------------
sudo systemctl status smbd

# --------------------------------------------
#  Установка autofs
# --------------------------------------------
#sudo apt-get update && sudo apt-get install autofs
sudo apt update && sudo apt install autofs

# --------------------------------------------
# Установим набор утилит для монтирования SMB
# Установка cifs-utils
# --------------------------------------------
#sudo apt-get update && sudo apt-get install cifs-utils
sudo apt update && sudo apt install cifs-utils

# После установки, демон autofs запустится автоматически,
# но на время конфигурирования его нужно отключить:
sudo /etc/init.d/autofs stop

[lyrnet_samba_check.sh]

# --------------------------------------------------------------------------------
# проверим, что сервис smbd запустился
# --------------------------------------------------------------------------------
sudo systemctl status smbd

[lyrnet_samba_restart.sh]

# --------------------------------------------
# sudo systemctl restart smbd
# --------------------------------------------
sudo systemctl restart smbd

[lyrspm_install_app_cifs-utils.sh]

# --------------------------------------------
#  Установка autofs
# --------------------------------------------
#sudo apt-get update && sudo apt-get install autofs
sudo apt update && sudo apt install autofs

# --------------------------------------------
# Установим набор утилит для монтирования SMB
# Установка cifs-utils
# --------------------------------------------
#sudo apt-get update && sudo apt-get install cifs-utils
sudo apt update && sudo apt install cifs-utils

# После установки, демон autofs запустится автоматически,
# но на время конфигурирования его нужно отключить:
sudo /etc/init.d/autofs stop

[lyrug_smbpasswd_lyr.sh]

# --------------------------------------------
# Создадим пользователя в samba lyr
# --------------------------------------------
sudo smbpasswd -a lyr

[lyrug_smbpasswd_lyr2.sh]

# --------------------------------------------
# Создадим пользователя в samba lyr2
# --------------------------------------------
sudo smbpasswd -a lyr2

3.Создание первой шары и предоставление к ней гостевого доступа (анонимного)

[lyrnet_samba_edit.sh]

# --------------------------------------------
# редактировать /etc/samba/smb.conf'
# --------------------------------------------
sudo vi /etc/samba/smb.conf

[lyrnet_samba_mount.sh]

# --------------------------------------------
# mount -t cifs
# --------------------------------------------
sudo mount -t cifs -o username=lyr,password=Lozudasa100 //192.168.1.31/WORK /mnt/DATA/ASUS-W10P/WORK
/mnt/ASUS-W10P/WORK
/mnt/ASUS-W10P/SOFT-install
/mnt/ASUS-W10P/PROJECTS_LYR

smb://ASUS-W10P/WORK
smb://ASUS-W10P/SOFT-install
smb://ASUS-W10P/PROJECTS_LYR

[lyrfd_ln_asus-w10p_projects_lyr.sh]

ln -s /run/user/1000/gvfs/smb-share:server=asus-w10p,share=projects_lyr

4.Установить Samba с графической оболочкой

[lyrspm_install_app_fly-admin-samba.sh]
Установить Samba с графической оболочкой, используя команду:
    sudo apt install fly-admin-samba

Создание папки общего доступа
    /home/teacher/share

Добавить пользователей, которые будут использовать сетевые папки.
    lyr

Установить режим доступа: либо полный доступ для определенных пользователей, либо только для чтения информации из папки.
    чтение
    чтение/запись
